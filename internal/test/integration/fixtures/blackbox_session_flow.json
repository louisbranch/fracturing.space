{
  "name": "mcp_http_blackbox_session_flow",
  "steps": [
    {
      "name": "initialize",
      "action": "initialize"
    },
    {
      "name": "initialized",
      "action": "initialized"
    },
    {
      "name": "campaign_create",
      "action": "tool_call",
      "tool": "campaign_create",
      "args": {
        "name": "Session Scenario",
        "system": "DAGGERHEART",
        "gm_mode": "HUMAN",
        "theme_prompt": "sessions"
      },
      "capture": {
        "campaign_id": "campaign"
      }
    },
    {
      "name": "owner_participant_read",
      "action": "read_resource",
      "uri": "campaign://{{campaign_id}}/participants",
      "capture": {
        "owner_id": "result.contents[0].text|json.participants[0].id"
      }
    },
    {
      "name": "set_context_owner",
      "action": "tool_call",
      "tool": "set_context",
      "args": {
        "campaign_id": {"ref": "campaign_id"},
        "participant_id": {"ref": "owner_id"}
      },
      "expect": "none"
    },
    {
      "name": "participant_create_player",
      "action": "tool_call",
      "tool": "participant_create",
      "args": {
        "campaign_id": {"ref": "campaign_id"},
        "name": "Scenario Player",
        "role": "PLAYER",
        "controller": "HUMAN"
      },
      "capture": {
        "player_id": "participant"
      }
    },
    {
      "name": "character_create_player",
      "action": "tool_call",
      "tool": "character_create",
      "args": {
        "campaign_id": {"ref": "campaign_id"},
        "name": "Scenario Hero",
        "kind": "PC"
      },
      "capture": {
        "character_id": "character"
      }
    },
    {
      "name": "character_control_set_player",
      "action": "tool_call",
      "tool": "character_control_set",
      "args": {
        "campaign_id": {"ref": "campaign_id"},
        "character_id": {"ref": "character_id"},
        "participant_id": {"ref": "player_id"}
      }
    },
    {
      "name": "character_list_read_before_session",
      "action": "read_resource",
      "uri": "campaign://{{campaign_id}}/characters",
      "capture": {
        "character_0_id": "result.contents[0].text|json.characters[0].id",
        "character_1_id": [
          "result.contents[0].text|json.characters[1].id",
          "result.contents[0].text|json.characters[0].id"
        ],
        "character_2_id": [
          "result.contents[0].text|json.characters[2].id",
          "result.contents[0].text|json.characters[0].id"
        ],
        "character_3_id": [
          "result.contents[0].text|json.characters[3].id",
          "result.contents[0].text|json.characters[0].id"
        ]
      }
    },
    {
      "name": "character_control_set_0",
      "action": "tool_call",
      "tool": "character_control_set",
      "args": {
        "campaign_id": {"ref": "campaign_id"},
        "character_id": {"ref": "character_0_id"},
        "participant_id": {"ref": "owner_id"}
      }
    },
    {
      "name": "character_control_set_1",
      "action": "tool_call",
      "tool": "character_control_set",
      "args": {
        "campaign_id": {"ref": "campaign_id"},
        "character_id": {"ref": "character_1_id"},
        "participant_id": {"ref": "owner_id"}
      }
    },
    {
      "name": "character_control_set_2",
      "action": "tool_call",
      "tool": "character_control_set",
      "args": {
        "campaign_id": {"ref": "campaign_id"},
        "character_id": {"ref": "character_2_id"},
        "participant_id": {"ref": "owner_id"}
      }
    },
    {
      "name": "character_control_set_3",
      "action": "tool_call",
      "tool": "character_control_set",
      "args": {
        "campaign_id": {"ref": "campaign_id"},
        "character_id": {"ref": "character_3_id"},
        "participant_id": {"ref": "owner_id"}
      }
    },
    {
      "name": "session_start",
      "action": "tool_call",
      "tool": "session_start",
      "args": {
        "campaign_id": {"ref": "campaign_id"},
        "name": "Scenario Session"
      },
      "capture": {
        "session_id": "session"
      }
    },
    {
      "name": "session_end",
      "action": "tool_call",
      "tool": "session_end",
      "args": {
        "campaign_id": {"ref": "campaign_id"},
        "session_id": {"ref": "session_id"}
      }
    },
    {
      "name": "session_list_read",
      "action": "read_resource",
      "uri": "campaign://{{campaign_id}}/sessions",
      "expect_paths": {
        "result.contents[0].text|json.sessions[0].id": "{{session_id}}",
        "result.contents[0].text|json.sessions[0].status": "ENDED"
      }
    }
  ]
}
