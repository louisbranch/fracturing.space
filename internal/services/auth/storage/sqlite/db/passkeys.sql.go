// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: passkeys.sql

package db

import (
	"context"
	"database/sql"
)

const deleteExpiredPasskeySessions = `-- name: DeleteExpiredPasskeySessions :exec
DELETE FROM passkey_sessions WHERE expires_at <= ?
`

func (q *Queries) DeleteExpiredPasskeySessions(ctx context.Context, expiresAt int64) error {
	_, err := q.db.ExecContext(ctx, deleteExpiredPasskeySessions, expiresAt)
	return err
}

const deletePasskey = `-- name: DeletePasskey :exec
DELETE FROM passkeys WHERE credential_id = ?
`

func (q *Queries) DeletePasskey(ctx context.Context, credentialID string) error {
	_, err := q.db.ExecContext(ctx, deletePasskey, credentialID)
	return err
}

const deletePasskeySession = `-- name: DeletePasskeySession :exec
DELETE FROM passkey_sessions WHERE id = ?
`

func (q *Queries) DeletePasskeySession(ctx context.Context, id string) error {
	_, err := q.db.ExecContext(ctx, deletePasskeySession, id)
	return err
}

const getPasskey = `-- name: GetPasskey :one
SELECT credential_id, user_id, credential_json, created_at, updated_at, last_used_at FROM passkeys WHERE credential_id = ?
`

func (q *Queries) GetPasskey(ctx context.Context, credentialID string) (Passkey, error) {
	row := q.db.QueryRowContext(ctx, getPasskey, credentialID)
	var i Passkey
	err := row.Scan(
		&i.CredentialID,
		&i.UserID,
		&i.CredentialJson,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.LastUsedAt,
	)
	return i, err
}

const getPasskeySession = `-- name: GetPasskeySession :one
SELECT id, kind, user_id, session_json, expires_at FROM passkey_sessions WHERE id = ?
`

func (q *Queries) GetPasskeySession(ctx context.Context, id string) (PasskeySession, error) {
	row := q.db.QueryRowContext(ctx, getPasskeySession, id)
	var i PasskeySession
	err := row.Scan(
		&i.ID,
		&i.Kind,
		&i.UserID,
		&i.SessionJson,
		&i.ExpiresAt,
	)
	return i, err
}

const listPasskeysByUser = `-- name: ListPasskeysByUser :many
SELECT credential_id, user_id, credential_json, created_at, updated_at, last_used_at FROM passkeys WHERE user_id = ? ORDER BY credential_id
`

func (q *Queries) ListPasskeysByUser(ctx context.Context, userID string) ([]Passkey, error) {
	rows, err := q.db.QueryContext(ctx, listPasskeysByUser, userID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []Passkey{}
	for rows.Next() {
		var i Passkey
		if err := rows.Scan(
			&i.CredentialID,
			&i.UserID,
			&i.CredentialJson,
			&i.CreatedAt,
			&i.UpdatedAt,
			&i.LastUsedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const putPasskey = `-- name: PutPasskey :exec
INSERT INTO passkeys (
    credential_id, user_id, credential_json, created_at, updated_at, last_used_at
) VALUES (?, ?, ?, ?, ?, ?)
ON CONFLICT(credential_id) DO UPDATE SET
    user_id = excluded.user_id,
    credential_json = excluded.credential_json,
    updated_at = excluded.updated_at,
    last_used_at = excluded.last_used_at
`

type PutPasskeyParams struct {
	CredentialID   string        `json:"credential_id"`
	UserID         string        `json:"user_id"`
	CredentialJson string        `json:"credential_json"`
	CreatedAt      int64         `json:"created_at"`
	UpdatedAt      int64         `json:"updated_at"`
	LastUsedAt     sql.NullInt64 `json:"last_used_at"`
}

func (q *Queries) PutPasskey(ctx context.Context, arg PutPasskeyParams) error {
	_, err := q.db.ExecContext(ctx, putPasskey,
		arg.CredentialID,
		arg.UserID,
		arg.CredentialJson,
		arg.CreatedAt,
		arg.UpdatedAt,
		arg.LastUsedAt,
	)
	return err
}

const putPasskeySession = `-- name: PutPasskeySession :exec
INSERT INTO passkey_sessions (
    id, kind, user_id, session_json, expires_at
) VALUES (?, ?, ?, ?, ?)
ON CONFLICT(id) DO UPDATE SET
    kind = excluded.kind,
    user_id = excluded.user_id,
    session_json = excluded.session_json,
    expires_at = excluded.expires_at
`

type PutPasskeySessionParams struct {
	ID          string         `json:"id"`
	Kind        string         `json:"kind"`
	UserID      sql.NullString `json:"user_id"`
	SessionJson string         `json:"session_json"`
	ExpiresAt   int64          `json:"expires_at"`
}

func (q *Queries) PutPasskeySession(ctx context.Context, arg PutPasskeySessionParams) error {
	_, err := q.db.ExecContext(ctx, putPasskeySession,
		arg.ID,
		arg.Kind,
		arg.UserID,
		arg.SessionJson,
		arg.ExpiresAt,
	)
	return err
}
