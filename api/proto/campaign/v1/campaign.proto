syntax = "proto3";

package campaign.v1;

import "google/protobuf/timestamp.proto";

option go_package = "github.com/louisbranch/duality-engine/api/gen/go/campaign/v1;campaignv1";

service CampaignService {
  // Create a new campaign metadata record.
  rpc CreateCampaign(CreateCampaignRequest) returns (CreateCampaignResponse);

  // List campaign metadata records.
  rpc ListCampaigns(ListCampaignsRequest) returns (ListCampaignsResponse);

  // Create a participant (GM or player) for a campaign.
  rpc CreateParticipant(CreateParticipantRequest) returns (CreateParticipantResponse);

  // List participants for a campaign.
  rpc ListParticipants(ListParticipantsRequest) returns (ListParticipantsResponse);

  // Create an actor (PC/NPC/etc) for a campaign.
  rpc CreateActor(CreateActorRequest) returns (CreateActorResponse);

  // List actors for a campaign.
  rpc ListActors(ListActorsRequest) returns (ListActorsResponse);

  // Assign a campaign-scoped default controller for an actor.
  rpc SetDefaultControl(SetDefaultControlRequest) returns (SetDefaultControlResponse);
}

message CreateCampaignRequest {
  // Display name for the campaign.
  string name = 1;

  // The mode of GM participation.
  GmMode gm_mode = 2;

  // Optional free-form theme prompt for assistants.
  string theme_prompt = 3;
}

message CreateCampaignResponse {
  Campaign campaign = 1;
  repeated string warnings = 2;
}

message ListCampaignsRequest {
  // The maximum number of campaigns to return.
  // If zero, the server defaults to 10. The server clamps values above 10 to 10.
  int32 page_size = 1;

  // A page token received from a prior ListCampaignsResponse.
  string page_token = 2;
}

message ListCampaignsResponse {
  repeated Campaign campaigns = 1;
  string next_page_token = 2;
}

message Campaign {
  string id = 1;
  string name = 2;
  GmMode gm_mode = 3;
  // Number of registered players for this campaign.
  int32 player_count = 4;
  string theme_prompt = 5;
  google.protobuf.Timestamp created_at = 6;
  google.protobuf.Timestamp updated_at = 7;
}

enum GmMode {
  GM_MODE_UNSPECIFIED = 0;
  HUMAN = 1;
  AI = 2;
  HYBRID = 3;
}

message CreateParticipantRequest {
  // The campaign ID to create the participant for.
  string campaign_id = 1;

  // Display name for the participant.
  string display_name = 2;

  // The role of the participant.
  ParticipantRole role = 3;

  // The controller type (defaults to HUMAN if unspecified).
  Controller controller = 4;
}

message CreateParticipantResponse {
  Participant participant = 1;
}

message Participant {
  string id = 1;
  string campaign_id = 2;
  string display_name = 3;
  ParticipantRole role = 4;
  Controller controller = 5;
  google.protobuf.Timestamp created_at = 6;
  google.protobuf.Timestamp updated_at = 7;
}

enum ParticipantRole {
  ROLE_UNSPECIFIED = 0;
  GM = 1;
  PLAYER = 2;
}

enum Controller {
  CONTROLLER_UNSPECIFIED = 0;
  CONTROLLER_HUMAN = 1;
  CONTROLLER_AI = 2;
}

message ListParticipantsRequest {
  // The campaign ID to list participants for.
  string campaign_id = 1;

  // The maximum number of participants to return.
  // If zero, the server defaults to 10. The server clamps values above 10 to 10.
  int32 page_size = 2;

  // A page token received from a prior ListParticipantsResponse.
  string page_token = 3;
}

message ListParticipantsResponse {
  repeated Participant participants = 1;
  string next_page_token = 2;
}

message CreateActorRequest {
  // The campaign ID to create the actor for.
  string campaign_id = 1;

  // Display name for the actor.
  string name = 2;

  // The kind of actor (PC or NPC).
  ActorKind kind = 3;

  // Optional free-form notes about the actor.
  string notes = 4;
}

message CreateActorResponse {
  Actor actor = 1;
}

message Actor {
  string id = 1;
  string campaign_id = 2;
  string name = 3;
  ActorKind kind = 4;
  string notes = 5;
  google.protobuf.Timestamp created_at = 6;
  google.protobuf.Timestamp updated_at = 7;
}

enum ActorKind {
  ACTOR_KIND_UNSPECIFIED = 0;
  PC = 1;
  NPC = 2;
}

message ListActorsRequest {
  // The campaign ID to list actors for.
  string campaign_id = 1;

  // The maximum number of actors to return.
  // If zero, the server defaults to 10. The server clamps values above 10 to 10.
  int32 page_size = 2;

  // A page token received from a prior ListActorsResponse.
  string page_token = 3;
}

message ListActorsResponse {
  repeated Actor actors = 1;
  string next_page_token = 2;
}

message SetDefaultControlRequest {
  // The campaign ID.
  string campaign_id = 1;

  // The actor ID.
  string actor_id = 2;

  // The controller for the actor.
  ActorController controller = 3;
}

message SetDefaultControlResponse {
  // The campaign ID.
  string campaign_id = 1;

  // The actor ID.
  string actor_id = 2;

  // The controller for the actor.
  ActorController controller = 3;
}

message ActorController {
  oneof controller {
    // If set, the controller is the GM.
    GmController gm = 1;

    // If set, the controller is a registered campaign participant.
    ParticipantController participant = 2;
  }
}

message GmController {
  // Empty message to indicate GM control.
}

message ParticipantController {
  // The participant ID of the controller.
  string participant_id = 1;
}
