syntax = "proto3";

package session.v1;

import "google/protobuf/timestamp.proto";

option go_package = "github.com/louisbranch/duality-engine/api/gen/go/session/v1;sessionv1";

service SessionService {
  // Start a new session for a campaign.
  // Enforces at most one ACTIVE session per campaign.
  rpc StartSession(StartSessionRequest) returns (StartSessionResponse);

  // List sessions for a campaign.
  rpc ListSessions(ListSessionsRequest) returns (ListSessionsResponse);
}

message StartSessionRequest {
  // The campaign ID to start a session for.
  string campaign_id = 1;

  // Optional free-form name for the session.
  string name = 2;
}

message StartSessionResponse {
  Session session = 1;
}

message Session {
  string id = 1;
  string campaign_id = 2;
  string name = 3;
  SessionStatus status = 4;
  google.protobuf.Timestamp started_at = 5;
  google.protobuf.Timestamp updated_at = 6;
  google.protobuf.Timestamp ended_at = 7;
  int64 version = 8;
}

enum SessionStatus {
  STATUS_UNSPECIFIED = 0;
  ACTIVE = 1;
  PAUSED = 2;
  ENDED = 3;
}

message ListSessionsRequest {
  // The campaign ID to list sessions for.
  string campaign_id = 1;

  // The maximum number of sessions to return.
  // If zero, the server defaults to 10. The server clamps values above 10 to 10.
  int32 page_size = 2;

  // A page token received from a prior ListSessionsResponse.
  string page_token = 3;
}

message ListSessionsResponse {
  repeated Session sessions = 1;
  string next_page_token = 2;
}
